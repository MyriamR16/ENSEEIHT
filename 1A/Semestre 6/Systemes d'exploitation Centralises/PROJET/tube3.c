#include <stdio.h>
#include <stdlib.h>
#include <stdbool.h>
#include <string.h>
#include <unistd.h>
#include <sys/types.h>
#include <sys/wait.h>
#include <fcntl.h>

int main() {
    int tube3[2];
    pid_t pid;
    int n;
    int nlus;
    int necrit;

    //création du tube
    if (pipe(tube3) == -1) {
        printf("Erreur: création du tube\n");
        exit(EXIT_FAILURE);
    }

    //création du fils
    pid = fork();


    if (pid < 0) {
        printf("Erreur: création du fils\n");
        exit(EXIT_FAILURE);
    }
   
    if (pid > 0) { //père
        close(tube3[0]);
        //le père écrit une série d'entiers dans le tube
        printf("donner une série d'entiers :\n");
        scanf("%d", &n);
        while ((necrit = write(tube3[1], &n, sizeof(int))) > 0) {
            scanf("%d", &n);
            if (necrit == -1) {
                printf("Erreur: entier\n");
                exit(EXIT_FAILURE);
            }
        }
        pause();
        close(tube3[1]);
       
    } else { //fils
        close(tube3[1]);
        while ((nlus = read(tube3[0], &n, sizeof(int))) > 0) {
            printf("l'entier lu par le fils est: %d\n", n);
        }
        printf("sortie de boucle\n");
        if (nlus == -1) {
            printf("Erreur: lecture de l'entier par le fils\n");
            exit(EXIT_FAILURE);
        }
       

        close(tube3[0]);
    }
    return EXIT_SUCCESS;
}
